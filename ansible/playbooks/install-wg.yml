---
  - hosts: wireguard
    tasks:
      - name: Update apt packages
        apt: upgrade=yes update_cache=yes
        when: ansible_facts['os_family'] == "Debian"
      - name: Ensure wireguard and basic system packages are installed
        apt:
          pkg:
            - wireguard
            - build-essential
            - jq
            - curl
            - wget
            - zsh
            - resolvconf
          state: present
      - name: Set sysctl to forward IP traffic
        blockinfile:
          path: /etc/sysctl.conf
          block: |
            net.ipv4.ip_forward=1
      - name: Reboot machine
        reboot:
          reboot_timeout: 120
